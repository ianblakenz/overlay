<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comment Queue Controller</title>
    <link rel="stylesheet" href="style.css">
    <style> body { background: #f0f2f5; } </style>
</head>
<body>
    <div class="controller">
        <h1>Comment Queue Manager</h1>
        <p>Paste a comment below and click 'Add to Queue'.</p>
        
        <textarea id="comment-input" placeholder="Paste comment here..."></textarea>
        
        <div class="buttons">
            <button id="btn-add-queue">Add to Queue</button>
            <button id="btn-display-next">Display Next Comment</button>
            <button id="btn-clear-all">Clear All</button>
        </div>

        <div id="queue-status">0 comments in queue</div>
        <ul id="queue-list">
            </ul>
    </div>

    <script>
        const QUEUE_KEY = 'ecamm_comment_queue';
        const CURRENT_COMMENT_KEY = 'ecamm_current_comment';

        const commentInput = document.getElementById('comment-input');
        const addButton = document.getElementById('btn-add-queue');
        const displayNextButton = document.getElementById('btn-display-next');
        const clearAllButton = document.getElementById('btn-clear-all');
        const queueStatus = document.getElementById('queue-status');
        const queueList = document.getElementById('queue-list');

        function getQueue() {
            return JSON.parse(localStorage.getItem(QUEUE_KEY) || '[]');
        }

        function saveQueue(queue) {
            localStorage.setItem(QUEUE_KEY, JSON.stringify(queue));
        }

        // --- RENDER QUEUE (UPDATED) ---
        // This function now builds the text and delete button
        function renderQueue() {
            const queue = getQueue();
            queueStatus.textContent = `${queue.length} comments in queue`;
            queueList.innerHTML = ''; // Clear the old list

            // Re-create the list
            queue.forEach((comment, index) => {
                const li = document.createElement('li');
                
                // Create span for the text
                const textSpan = document.createElement('span');
                textSpan.textContent = comment;
                
                // Create the delete button
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.className = 'btn-delete-item';
                // IMPORTANT: We add the index as a data attribute
                deleteButton.setAttribute('data-index', index);
                
                // Add text and button to the list item
                li.appendChild(textSpan);
                li.appendChild(deleteButton);
                
                queueList.appendChild(li);
            });
        }

        // --- NEW: Event Listener for Delete Buttons ---
        // We use event delegation on the parent list
        queueList.addEventListener('click', (event) => {
            // Check if the clicked element is a delete button
            if (event.target.classList.contains('btn-delete-item')) {
                // Get the index from the data attribute
                const indexToDelete = parseInt(event.target.getAttribute('data-index'), 10);
                
                let queue = getQueue();
                // Remove the item at that index
                queue.splice(indexToDelete, 1);
                
                saveQueue(queue); // Save the modified queue
                renderQueue(); // Re-draw the list
            }
        });

        // --- Button Event Listeners (Unchanged) ---
        addButton.addEventListener('click', () => {
            const text = commentInput.value;
            if (text.trim() === '') return; 
            const queue = getQueue();
            queue.push(text);
            saveQueue(queue);
            commentInput.value = '';
            renderQueue();
        });

        displayNextButton.addEventListener('click', () => {
            const queue = getQueue();
            if (queue.length === 0) {
                localStorage.setItem(CURRENT_COMMENT_KEY, '');
                return;
            }
            const nextComment = queue.shift();
            saveQueue(queue);
            localStorage.setItem(CURRENT_COMMENT_KEY, nextComment);
            renderQueue();
        });

        clearAllButton.addEventListener('click', () => {
            saveQueue([]);
            localStorage.setItem(CURRENT_COMMENT_KEY, '');
            renderQueue();
        });

        // --- Initial Load ---
        renderQueue();

    </script>
</body>
</html>
