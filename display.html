<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comment Display</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <div id="logo-container">
        <img src="https://media.faaa.com.au/logo/faaa_logo.png" alt="FAAA Logo">
    </div>

    <div id="comment-container">
        <div id="comment-header">
            <span id="header-text-static">FAAA Live</span>
            <span id="header-text-time"></span>
        </div>
        <div id="comment-body">
            <div id="comment-text"></div>
        </div>
    </div>

    <script>
        // --- NEW: Wait for the page to be fully loaded ---
        document.addEventListener('DOMContentLoaded', () => {

            // --- Get All Elements ---
            const logoContainer = document.getElementById('logo-container');
            const commentContainer = document.getElementById('comment-container');
            const commentText = document.getElementById('comment-text');
            const headerStatic = document.getElementById('header-text-static');
            const headerTime = document.getElementById('header-text-time');

            const CURRENT_COMMENT_KEY = 'ecamm_current_comment';
            
            // --- Header Timer Logic ---
            let headerInterval = null; // Stores our 5-second timer

            function startHeaderTimer() {
                if (headerInterval) clearInterval(headerInterval);
                let showTime = false;
                
                const updateHeaderText = () => {
                    if (showTime) {
                        const now = new Date();
                        const timeString = now.toLocaleTimeString('en-AU', {
                            hour: '2-digit', 
                            minute: '2-digit' 
                        });
                        headerTime.textContent = timeString;
                        
                        headerStatic.style.opacity = '0';
                        headerTime.style.opacity = '1';
                    } else {
                        headerStatic.style.opacity = '1';
                        headerTime.style.opacity = '0';
                    }
                    showTime = !showTime;
                };
                
                updateHeaderText();
                headerInterval = setInterval(updateHeaderText, 5000);
            }

            function stopHeaderTimer() {
                if (headerInterval) clearInterval(headerInterval);
                headerInterval = null;
                headerStatic.style.opacity = '1';
                headerTime.style.opacity = '0';
            }

            // --- Main Animation & Logic ---
            let isAnimating = false;
            let currentText = ''; 

            function updateComment(text) {
                if (isAnimating || text === currentText) return;
                
                currentText = text; 

                if (text && text.trim() !== '') {
                    // --- SEQUENCE TO *SHOW* A COMMENT ---
                    isAnimating = true;
                    
                    commentContainer.classList.remove('visible');
                    stopHeaderTimer();
                    logoContainer.classList.add('visible');

                    setTimeout(() => {
                        logoContainer.classList.remove('visible');
                        commentText.innerText = text;
                        
                        setTimeout(() => {
                            commentContainer.classList.add('visible');
                            startHeaderTimer();
                            isAnimating = false;
                        }, 500); // Must match logo's fade-out time

                    }, 2500); // How long logo stays on-screen

                } else {
                    // --- SEQUENCE TO *HIDE* A COMMENT ---
                    commentContainer.classList.remove('visible');
                    stopHeaderTimer();
                    currentText = '';
                }
            }

            // --- Storage Listener ---
            window.addEventListener('storage', (event) => {
                if (event.key === CURRENT_COMMENT_KEY) {
                    updateComment(event.newValue);
                }
            });

            // --- Initial Load ---
            const initialText = localStorage.getItem(CURRENT_COMMENT_KEY);
            if (initialText) {
                currentText = initialText;
                commentText.innerText = initialText;
                commentContainer.classList.add('visible');
                startHeaderTimer();
            }

        }); // --- END of DOMContentLoaded wrapper ---
    </script>
</body>
</html>
